### HTTP协议

HTTP 协议，即超文本传输协议，Hyper Text Transfer Protocol，是应用层协议，用于从 WWW 服务器传输超文本到本地浏览器的传送协议。HTTP 协议是以 ASCII 码传输的，构建于 TCP/IP 协议之上，同时承载于 TLS 或 SSL 协议之上时成为了 HTTPS （即，HTTP over SSL/TLS）协议。HTTP 协议默认的端口号是80，HTTPS 协议默认的端口号是443。

![HTTP协议在TCP/IP协议栈中的位置](/assets/20110826201312465.jpg)

#### 1、HTTP 通信过程

HTTP 协议永远都是客户端发起请求，服务器响应，是**无状态**（同一个客户端的请求与上一次请求是没有对应关系的，每次都是一个新的连接）的协议。

HTTP 协议的**连接**：

- 最初HTTP/0.9时代，是**短连接**，每次 HTTP 请求都要经历一次DNS解析、三次握手、传输和四次挥手。需要反复创建和断开 TCP 连接，开销巨大；
- HTTP/1.0 时代，开始支持持久连接，即一个 TCP 连接服务多次请求，客户端在请求头中携带`Connection:Keep-Alive`，向服务器请求持久连接，如果服务器接受持久连接，会在响应头中携带`Connection:Keep-Alive`，这样客户端可以使用同一个 TCP 连接发送多个请求；
- HTTP/1.1 时代，**持久连接**是默认的连接方式，即使请求头中没有携带`Connection:Keep-Alive`，传输也会默认以持久连接的方式进行，可以通过`Connection:Close`关闭持久连接。但是，持久连接存在 HOLB （Head of Line Blocking）的弊端，即连接中请求是串行的，如果某个请求出现网络阻塞等问题，会导致同一个连接上的后续请求被阻塞。HTTP/1.1提出了 pipelining 的概念，即同一个连接中，客户端可以在没有收到上一个请求的响应的情况下发起第二个请求，服务端根据收到请求的顺序依次返回响应，这样极大地降低了延迟。但是 pipelining 没有被广泛接受。
- HTTP/2 中，实现了 multiplexing ，即**多路复用**，一个连接中多个请求和响应的传输可以完全混杂在一起进行，通过 streamId 进行区别，从而彻底解决了 HOLB 问题，同时运行为请求设置优先级，服务端会优先响应优先级高的请求。

HTTP 协议的**流程**：

- 浏览器建立与服务器之间的连接
- 浏览器将请求数据打包发送到 web 服务器
- web服务器处理请求，将结果打包发送给浏览器
- web服务器关闭连接

#### 2、HTTP 数据包

HTTP 的请求数据包由三部分（状态行、请求头、请求体，请求头与请求体之间由**空行**隔开）组成。

- 状态行（请求行），包含了请求方法（GET、POST、PUT等）、请求URL、协议的版本和类型
- 请求头（headers），一些键值对，一般由w3c定义，浏览器与web服务器之间都可以发送，表示特定的某种含义
- 请求体，发送的数据

